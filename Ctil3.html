<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Waste Management Report</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
      max-width: 450px;
      margin: auto;
    }
    h2 { text-align: center; color: #2d7a2d; }
    .btn {
      display: block;
      width: 100%;
      background: #2d7a2d;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    }
    .btn:hover { background: #256b25; }
    #preview { margin-top: 10px; max-width: 100%; border-radius: 8px; }
    iframe { width: 100%; height: 250px; border: 0; margin-top: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Report Garbage Spot</h2>

  <label>üñºÔ∏è Choose a Photo (Gallery)</label>
  <input type="file" id="galleryInput" accept="image/*">

  <label for="cameraInput" class="btn">üì∑ Click a Photo (Camera)</label>
  <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none">

  <img id="preview" src="#" alt="Preview" style="display:none;"/>

  <h3>üìç Location</h3>
  <button class="btn" id="getLocationBtn">Get My Location</button>

  <p>Or enter manually:</p>
  <input type="text" id="manualLat" placeholder="Enter Latitude">
  <input type="text" id="manualLong" placeholder="Enter Longitude">

  <iframe id="mapFrame" style="display:none;"></iframe>

  <button class="btn" id="showMapBtn">Show Map for Manual Location</button>
  <button class="btn" id="submitBtn">‚úÖ Submit Report</button>

  <script>
    // ‚úÖ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCWGhoKTqy8ORIePTEsuID70-YUnd7Pe1g",
      authDomain: "smartwastereport.firebaseapp.com",
      projectId: "smartwastereport",
      storageBucket: "smartwastereport.firebasestorage.app",
      messagingSenderId: "530218844017",
      appId: "1:530218844017:web:066e2d602eed5b3c8a80d0",
      measurementId: "G-GGD62VY2FW"
    };

    // üî• Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    let latitude = null, longitude = null, imageFile = null;

    const galleryInput = document.getElementById('galleryInput');
    const cameraInput = document.getElementById('cameraInput');
    const preview = document.getElementById('preview');
    const getLocationBtn = document.getElementById('getLocationBtn');
    const showMapBtn = document.getElementById('showMapBtn');
    const mapFrame = document.getElementById('mapFrame');
    const submitBtn = document.getElementById('submitBtn');
    const manualLat = document.getElementById('manualLat');
    const manualLong = document.getElementById('manualLong');

    // Image preview
    function showPreview(input) {
      const file = input.files[0];
      if (file) {
        imageFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    galleryInput.addEventListener('change', () => showPreview(galleryInput));
    cameraInput.addEventListener('change', () => showPreview(cameraInput));

    // GPS
    getLocationBtn.addEventListener('click', () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            latitude = pos.coords.latitude;
            longitude = pos.coords.longitude;
            alert(`üìç Captured:\nLat: ${latitude}\nLong: ${longitude}`);
            mapFrame.src = `https://www.google.com/maps?q=${latitude},${longitude}&z=14&output=embed`;
            mapFrame.style.display = 'block';
          },
          () => alert('Unable to get location.')
        );
      } else alert('Geolocation not supported.');
    });

    showMapBtn.addEventListener('click', () => {
      const lat = manualLat.value, long = manualLong.value;
      if (lat && long) {
        mapFrame.src = `https://www.google.com/maps?q=${lat},${long}&z=14&output=embed`;
        mapFrame.style.display = 'block';
      } else alert('Enter both coordinates.');
    });

// ‚úÖ Submit using backend
submitBtn.addEventListener('click', async () => {
  const lat = manualLat.value || latitude;
  const long = manualLong.value || longitude;
  if (!imageFile) return alert('Please select a photo!');
  if (!lat || !long) return alert('Provide location.');

  const fd = new FormData();
  fd.append('image', imageFile);
  fd.append('latitude', lat);
  fd.append('longitude', long);

  try {
    const res = await fetch('http://localhost:3000/report', {
      method: 'POST',
      body: fd
    });

    const data = await res.json();
    if (data.success) {
      alert('‚úÖ Report submitted successfully!');
      location.reload();
    } else {
      alert('‚ùå Error: ' + (data.error || 'Unknown'));
    }
  } catch (err) {
    alert('Network error: ' + err.message);
  }
});


  </script>
</body>
</html>