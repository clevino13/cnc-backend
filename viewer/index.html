<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‚ôªÔ∏è NGO Reports Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f6fa; padding:20px; max-width:900px; margin:auto; }
    h2 { text-align:center; color:#2d7a2d; }
    #list { margin-top:15px; }
    .card {
      background:white;
      border-radius:8px;
      padding:12px;
      margin:10px 0;
      box-shadow:0 1px 4px rgba(0,0,0,0.1);
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    img { width:140px; height:100px; object-fit:cover; border-radius:6px; }
    .meta { flex:1; font-size:14px; }
    .meta p { margin:4px 0; }
    .meta a { color:#256b25; text-decoration:none; }
    .meta a:hover { text-decoration:underline; }
    button {
      background:#c0392b;
      color:white;
      border:none;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
    }
    button:disabled { opacity:0.6; cursor:wait; }
    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .refresh-btn {
      background:#2d7a2d;
      padding:8px 14px;
    }
  </style>
</head>
<body>
  <h2>‚ôªÔ∏è NGO Reports Viewer</h2>

  <div class="top-bar">
    <p>Total reports: <span id="count">0</span></p>
    <button class="refresh-btn" onclick="loadReports()">üîÑ Refresh</button>
  </div>

  <div id="list">Loading...</div>

  <script>
    async function loadReports() {
      const list = document.getElementById('list');
      const countSpan = document.getElementById('count');
      list.innerHTML = '<p>Loading...</p>';
      countSpan.textContent = '...';

      try {
        // Viewer is served from backend, so relative URL works:
        const res = await fetch('/reports');
        const reports = await res.json();

        list.innerHTML = '';
        countSpan.textContent = reports.length;

        if (reports.length === 0) {
          list.innerHTML = '<p>No reports yet.</p>';
          return;
        }

        reports.forEach(r => {
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
            <img src="${r.imageUrl}" alt="Report Image" />
            <div class="meta">
              <p><b>Description:</b> ${r.description || 'No description'}</p>
              <p><b>Latitude:</b> ${r.latitude}</p>
              <p><b>Longitude:</b> ${r.longitude}</p>
              <p><a href="https://www.google.com/maps?q=${r.latitude},${r.longitude}" target="_blank">üìç Open in Google Maps</a></p>
              <p style="font-size:12px;color:#777;">${r.timestamp ? '' : ''}</p>
            </div>
            <button onclick="deleteReport('${r.id}', this)">üóëÔ∏è Delete</button>
          `;
          list.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        list.innerHTML = '<p style="color:red;">Error loading reports.</p>';
        countSpan.textContent = '0';
      }
    }

    async function deleteReport(id, btn) {
      if (!confirm("Are you sure you want to delete this image?")) return;

      btn.disabled = true;
      btn.textContent = "Deleting...";

      try {
        const res = await fetch(`/report/${id}`, { method: 'DELETE' });
        const data = await res.json();

        if (data.success) {
          alert("‚úÖ Deleted successfully!");
          loadReports();
        } else {
          alert("‚ùå Failed to delete image.");
          btn.disabled = false;
          btn.textContent = "üóëÔ∏è Delete";
        }
      } catch (err) {
        console.error(err);
        alert("‚ö†Ô∏è Network error while deleting.");
        btn.disabled = false;
        btn.textContent = "üóëÔ∏è Delete";
      }
    }

    loadReports();
  </script>
</body>
</html>
